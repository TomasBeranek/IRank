{
    "label_source": "auto_labeler",
    "bug_type": "NULL_DEREFERENCE",
    "project": "libtiff",
    "bug_info": {
        "qualifier": "pointer `crop_buff` last assigned on line 7654 could be null and is dereferenced by call to `_TIFFmemset()` at line 7656, column 5.",
        "file": "tools/tiffcrop.c",
        "procedure": "createCroppedImage",
        "line": 7656,
        "column": 5,
        "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7656"
    },
    "adjusted_bug_loc": null,
    "bug_loc_trace_index": -1,
    "versions": {
        "before": "632f6a1a4f830f69d62fc0314b2109a2d9025963",
        "after": "691427ea8dd175db1671c77d496385e1c4760712"
    },
    "sample_type": "before_fix",
    "trace": [
        {
            "idx": 0,
            "level": 0,
            "description": "start of procedure createCroppedImage()",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7632:1",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7632"
        },
        {
            "idx": 1,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7637:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7637"
        },
        {
            "idx": 2,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7638:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7638"
        },
        {
            "idx": 3,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7639:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7639"
        },
        {
            "idx": 4,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7640:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7640"
        },
        {
            "idx": 5,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7642:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7642"
        },
        {
            "idx": 6,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7645:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7645"
        },
        {
            "idx": 7,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7646:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7646"
        },
        {
            "idx": 8,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7647:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7647"
        },
        {
            "idx": 9,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7648:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7648"
        },
        {
            "idx": 10,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7650:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7650"
        },
        {
            "idx": 11,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7651:3",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7651"
        },
        {
            "idx": 12,
            "level": 0,
            "description": "Taking true branch",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7652:8",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7652"
        },
        {
            "idx": 13,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7654:5",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7654"
        },
        {
            "idx": 14,
            "level": 1,
            "description": "start of procedure limitMalloc()",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "629:1",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L629"
        },
        {
            "idx": 15,
            "level": 1,
            "description": "Taking true branch",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "631:7",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L631"
        },
        {
            "idx": 16,
            "level": 1,
            "description": "Taking true branch",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "631:21",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L631"
        },
        {
            "idx": 17,
            "level": 1,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "632:5",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L632"
        },
        {
            "idx": 18,
            "level": 1,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "634:5",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L634"
        },
        {
            "idx": 19,
            "level": 1,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "634:76",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L634"
        },
        {
            "idx": 20,
            "level": 1,
            "description": "return from a call to limitMalloc",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "637:1",
            "func_name": "limitMalloc",
            "func_key": "tools/tiffcrop.c@629:1-637:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L637"
        },
        {
            "idx": 21,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7655:5",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7655"
        },
        {
            "idx": 22,
            "level": 0,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "tools/tiffcrop.c",
            "loc": "7656:5",
            "func_name": "createCroppedImage",
            "func_key": "tools/tiffcrop.c@7632:1-7745:4",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/tools/tiffcrop.c/#L7656"
        },
        {
            "idx": 23,
            "level": 1,
            "description": "start of procedure _TIFFmemset()",
            "func_removed": null,
            "file_removed": null,
            "file": "libtiff/tif_unix.c",
            "loc": "337:1",
            "func_name": "_TIFFmemset",
            "func_key": "libtiff/tif_unix.c@337:1-341:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/libtiff/tif_unix.c/#L337"
        },
        {
            "idx": 24,
            "level": 1,
            "description": "",
            "func_removed": null,
            "file_removed": null,
            "file": "libtiff/tif_unix.c",
            "loc": "340:2",
            "func_name": "_TIFFmemset",
            "func_key": "libtiff/tif_unix.c@337:1-341:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/libtiff/tif_unix.c/#L340"
        },
        {
            "idx": 25,
            "level": 1,
            "description": "return from a call to _TIFFmemset",
            "func_removed": null,
            "file_removed": null,
            "file": "libtiff/tif_unix.c",
            "loc": "341:1",
            "func_name": "_TIFFmemset",
            "func_key": "libtiff/tif_unix.c@337:1-341:2",
            "is_func_definition": true,
            "url": "https://gitlab.com/libtiff/libtiff/blob/632f6a1a4f830f69d62fc0314b2109a2d9025963/libtiff/tif_unix.c/#L341"
        }
    ],
    "functions": {
        "tools/tiffcrop.c@7632:1-7745:4": {
            "file": "tools/tiffcrop.c",
            "loc": "7632:1-7745:4",
            "name": "createCroppedImage",
            "touched_by_commit": false,
            "code": "static int\ncreateCroppedImage(struct image_data *image, struct crop_mask *crop, \n                   unsigned char **read_buff_ptr, unsigned char **crop_buff_ptr)\n  {\n  tsize_t   cropsize;\n  unsigned  char *read_buff = NULL;\n  unsigned  char *crop_buff = NULL;\n  unsigned  char *new_buff  = NULL;\n  static    tsize_t  prev_cropsize = 0;\n\n  read_buff = *read_buff_ptr;\n\n  /* process full image, no crop buffer needed */\n  crop_buff = read_buff;\n  *crop_buff_ptr = read_buff;\n  crop->combined_width = image->width;\n  crop->combined_length = image->length;\n\n  cropsize = crop->bufftotal;\n  crop_buff = *crop_buff_ptr;\n  if (!crop_buff)\n    {\n    crop_buff = (unsigned char *)limitMalloc(cropsize);\n    *crop_buff_ptr = crop_buff;\n    _TIFFmemset(crop_buff, 0, cropsize);\n    prev_cropsize = cropsize;\n    }\n  else\n    {\n    if (prev_cropsize < cropsize)\n      {\n      new_buff = _TIFFrealloc(crop_buff, cropsize);\n      if (!new_buff)\n        {\n\tfree (crop_buff);\n        crop_buff = (unsigned char *)limitMalloc(cropsize);\n        }\n      else\n        crop_buff = new_buff;\n      _TIFFmemset(crop_buff, 0, cropsize);\n      }\n    }\n\n  if (!crop_buff)\n    {\n    TIFFError(\"createCroppedImage\", \"Unable to allocate/reallocate crop buffer\");\n    return (-1);\n    }\n  *crop_buff_ptr = crop_buff;\n\n  if (crop->crop_mode & CROP_INVERT)\n    {\n    switch (crop->photometric)\n      {\n      /* Just change the interpretation */\n      case PHOTOMETRIC_MINISWHITE:\n      case PHOTOMETRIC_MINISBLACK:\n\t   image->photometric = crop->photometric;\n\t   break;\n      case INVERT_DATA_ONLY:\n      case INVERT_DATA_AND_TAG:\n           if (invertImage(image->photometric, image->spp, image->bps, \n                           crop->combined_width, crop->combined_length, crop_buff))\n             {\n             TIFFError(\"createCroppedImage\", \n                       \"Failed to invert colorspace for image or cropped selection\");\n             return (-1);\n             }\n           if (crop->photometric == INVERT_DATA_AND_TAG)\n             {\n             switch (image->photometric)\n               {\n               case PHOTOMETRIC_MINISWHITE:\n \t            image->photometric = PHOTOMETRIC_MINISBLACK;\n\t            break;\n               case PHOTOMETRIC_MINISBLACK:\n \t            image->photometric = PHOTOMETRIC_MINISWHITE;\n\t            break;\n               default:\n\t            break;\n\t       }\n\t     }\n           break;\n      default: break;\n      }\n    }\n\n  if (crop->crop_mode & CROP_MIRROR)\n    {\n    if (mirrorImage(image->spp, image->bps, crop->mirror, \n                    crop->combined_width, crop->combined_length, crop_buff))\n      {\n      TIFFError(\"createCroppedImage\", \"Failed to mirror image or cropped selection %s\", \n\t       (crop->rotation == MIRROR_HORIZ) ? \"horizontally\" : \"vertically\");\n      return (-1);\n      }\n    }\n\n  if (crop->crop_mode & CROP_ROTATE) /* rotate should be last as it can reallocate the buffer */\n    {\n    if (rotateImage(crop->rotation, image, &crop->combined_width, \n                    &crop->combined_length, crop_buff_ptr))\n      {\n      TIFFError(\"createCroppedImage\", \n                \"Failed to rotate image or cropped selection by %d degrees\", crop->rotation);\n      return (-1);\n      }\n    }\n\n  if (crop_buff == read_buff) /* we used the read buffer for the crop buffer */\n    *read_buff_ptr = NULL;    /* so we don't try to free it later */\n\n  return (0);\n  }"
        },
        "tools/tiffcrop.c@629:1-637:2": {
            "file": "tools/tiffcrop.c",
            "loc": "629:1-637:2",
            "name": "limitMalloc",
            "touched_by_commit": false,
            "code": "static void* limitMalloc(tmsize_t s)\n{\n  if (maxMalloc && (s > maxMalloc)) {\n    fprintf(stderr, \"MemoryLimitError: allocation of \" TIFF_UINT64_FORMAT \" bytes is forbidden. Limit is \" TIFF_UINT64_FORMAT \".\\n\",\n            (uint64)s, (uint64)maxMalloc);\n    fprintf(stderr, \"                  use -k option to change limit.\\n\"); return NULL;\n  }\n  return _TIFFmalloc(s);\n}"
        },
        "libtiff/tif_unix.c@337:1-341:2": {
            "file": "libtiff/tif_unix.c",
            "loc": "337:1-341:2",
            "name": "_TIFFmemset",
            "touched_by_commit": false,
            "code": "void\n_TIFFmemset(void* p, int v, tmsize_t c)\n{\n\tmemset(p, v, (size_t) c);\n}"
        }
    },
    "commit": {
        "url": "https://gitlab.com/libtiff/libtiff/commit/691427ea8dd175db1671c77d496385e1c4760712",
        "changes": [
            {
                "before": "tools/tiffinfo.c",
                "after": "tools/tiffinfo.c",
                "changes": [
                    "410,2^^410,2",
                    "414,1^^414,1",
                    "457,0^^458,16"
                ]
            }
        ]
    },
    "compiler_args": {
        "tools/tiffcrop.c": "-DHAVE_CONFIG_H -I<$repo$>/tools -I<$repo$>/libtiff",
        "libtiff/tif_unix.c": "-DHAVE_CONFIG_H -I<$repo$>/libtiff -DPIC"
    },
    "zipped_bug_report": "H4sIAHFjQ18C/+1YYU/jRhD93PyKKZVOcRRM4sROYnRIVXtISEClE/elqgiOvUks4t3UXsNRxH/vzK5t7GD3EgjStWokxNo7O/Pe293x7P40mNjjlhRilRzJcD73Y7E2fXfk2I4LLI5F7MJlulrBryxmc/zjPmsBrEXIJYvhhuyns3Q+v4GVl0jwkiRccBaA4LAKOQP0NARfpKsAZgw4ufJ4AGECwbNH7HsA38M+KeBmenV2ehqxKGGybdyAJwtPThddrdKIg2226lAPLLfvQiK9WIKYwzoW6DyNGfgx8yT7Be3WLDiLvAVrGy2075kAHZBLBpFA+GItwyj8CwGtPbmE+yXjwAX8LjhLQMTwmS1CwRPw0GXM/kzDmAUm+emTnyNqWSbFl6EPKBFKRb9r6hiYdSgSGae+hJAepoEnPeiodheyHqVw5CW30KFmF8jX0ISaX8oz8f2lF0Ong9ECNTnTtYy7L7qLuaNuo17PkTtwVUSbIj5Sy6GWTFClqcQW2dLDMfWNzDKMLFABAz7C5Zfz8+NWDljpMq4bU2ArxqDlpM6Ss3ttWFjWEhnnRPYAf3vQFaJbwh85Q1qV+Soqo13H7G6aI8YBvQayk5zs3gltT6NMfRdCaI2bqZbXsJfz2jva3TBWuBFa/GfR8LK01e1XP1NDK2P0CoW2iVkBOtCDVO446ujkmCQwp5yc5RzMdRQLyAOmd85YgKphYqsFb+fg3+KZ/JjZRsxpFCw2GKi9W81bVWu0GeXODk98Ec3wyxFM78MAs/lHjeXwRD02TIiTc3oPMttQqBDengwaj2uMV4wvytb6uYF7nuzfzGEn5BXCu3BA80lTpsjT/Z6x7oiwQm2iNondM0tfHRyiXREWKaS3qp8aO898rxFom6BlpHZ/c/qr+pFjW6WecA7tH4u++hLC7ufQt8WyDYIK3los+H6gq6THelyWO3bhyrsN+QKw1GIwiz3uL/cGsQlYpWS7ruCkYlm3y47bG4WbscIaVV5guSz8do7SaFg4Q9dW6n9bpLcF36Bka08vNl7xrPRxtFW54C8MutDrwj+yc6xJQ7VfxkiCO9ZI1flXSzx3+GkiRQSR6sa0zn2JNT0wPhexz8DDnq9hlEagDDzVSRiUn7Gu86k5KQr9OxEGnUpQGWXf76SY72saROeNR9Xo59OB0fQg+PAB2gmcQPHGMGrXLg52R7VLdzdYr0GzsXhprKUncb6O8cAzxwMNHuzwtHFwwSIRP5xT+E/6IFkSFKfrAGjap1/OLq+c4fT0t88XP1/hy9mDxLMWzhNOxywMAsZNUE7oXf0Y8w9+0FVYBtVzUTtFSM7QSLpF85nOcYO0Vv970Bb+80pbKjO9VqrvSY2NadpNGhoxbKBSc8RPGBzeqnsKZCMFZWW+yDIe4TGOsbiRacwbD8MYrlD+37ui3lm2F5OqPmhPqunoU5ey1p8unQESo0nukfO/3lvrvaffm6dtRMVFZj+PsWLwiivKUt7fJQr1YyHyVC0JsKRQ/5vOMradl3B7KtW2K882CrpdSjU0H2nzzduL59u2hjvnjOm7s9uR0YYY32SHNmNt89RqrcIZ0SSu05SHX5HrQK+umtK1cvmNcQe0uJ5Uw1ELZUBLiMqP8ioa0CoqD9X1ybpLl9Bw14WiOvG10wl9cmuRDXuu5cKrfWKD7rJ+yMagNVq2taEBvlE+upFtP2NHd1kNgPrNG7EEbzcIReASFEvrS7dZSt+/Aay6feocGQAA"
}
